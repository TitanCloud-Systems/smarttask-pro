Refactored state updates and removed redundant variables to reduce gas consumption.
